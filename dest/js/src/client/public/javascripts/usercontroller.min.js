/*! bae-nodejs 09-03-2017 */
polls1.controller("UserCtrl",["$scope","$http","userservice","$location",function(a,b,c,d){a.test="test",a.login=function(){var b=a.user.account,e=a.user.password;a.error=!1,a.disabled=!0,c.signin({account:b,password:e}).then(function(c){"ok"==c.status?(a.$emit("userchange",{islogin:!0,account:a.user.account}),d.path("/"),a.islogin=!0,a.currusername=a.user.account):"wrongpass"==c.status?(a.islogin=!1,a.msg="Invalid username and/or password. 用户名/密码不对"):"notexist"==c.status&&(a.islogin=!1,a.msg="User "+b+" does not exist. 用户"+b+"不存在")}).catch(function(){a.error=!0,a.msg="Invalid username and/or password",a.disabled=!1,a.user={}})},a.logout=function(){c.signout().then(function(b){b.status&&(a.$emit("userchange",{islogin:!1,account:""}),a.islogin=!1,a.currusername="")})};var e=0;a.tt=function(){var b="dd",d="rere";c.signup({account:b,password:d}).then(function(a){if("exist"==a.status)return c.signin({account:b,password:d})}).then(function(b){"wrongpass"==b.status&&a.$emit("userchange",{islogin:!0,test:!0,t:e})})},a.register=function(){a.error=!1,a.disabled=!0;var b=a.user.account,f=a.user.password;c.signup({account:b,password:f}).then(function(d){return"ok"==d.status?a.autologin?c.signin({account:b,password:f}):"tologin":"exist"==d.status?"exist":void 0}).then(function(c){"ok"==c.status?(e+=1,a.$emit("userchange",{islogin:!0,account:b}),console.log("emituserchange"),d.path("/")):"wrongpass"==c.status?(a.msg="Password not matched. 密码不对",d.path("/login"),a.disabled=!1):"exist"==c?(e+=1,console.log("emituserchange test:true,t=",e),a.msg='User "'+b+'" alrady exist! 用户 '+b+" 已存在"):"tologin"==c&&d.path("/login")}).catch(function(){a.error=!0,a.msg="Something went wrong!",a.disabled=!1})}}]);