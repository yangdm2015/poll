/*! bae-nodejs 09-03-2017 */
polls1.factory("pollservice",["$q","$http",function(a,b){var c=function(){var c=a.defer(),d=c.promise;return b.get("/polls/polls").success(function(a){c.resolve(a)}).error(function(a){c.reject(a)}),d},d=function(c){var d=a.defer(),e=d.promise;return b.get("/polls/"+c).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)}),e},e=function(c){var d=a.defer(),e=d.promise;if(c.question.length>0){for(var f=0,g=0,h=c.choices.length;g<h;g++){var i=c.choices[g];i.text.length>0&&f++}if(f>1){var j={method:"post",url:"polls",data:{poll:c}};b(j).success(function(a){console.log("save successful"),d.resolve(a)}).error(function(a){d.reject(a),alert("暂时不能创建投票，请稍后再试")})}else alert("你必须至少填写两个选项！")}else alert("你必须填写投票主题！");return e},f=function(c){var d=a.defer(),e=d.promise;if(c){var f="/mypolls/"+c;b.get(f).success(function(a){console.log("in getmypoll, return data=",a),d.resolve(a)}).error(function(a){d.reject(a)})}else d.reject("Please login first!");return e},g=function(c){var d=a.defer(),e=d.promise;if(c){var f="/myvotes/"+c;b.get(f).success(function(a){d.resolve(a)}).error(function(a){d.reject(a)})}else d.reject("Please login first!");return e};return{getmypoll:f,getmyvote:g,getpoll:d,getallpolls:c,savepoll:e}}]).factory("socket",function(a,b){var c=io.connect();return{on:function(a,d){c.on(a,function(){var a=arguments;b(function(){d.apply(c,a)},0)})},emit:function(a,d,e){c.emit(a,d,function(){var a=arguments;b(function(){e&&e.apply(c,a)},0)})}}});